---
import { getCollection } from 'astro:content';
import Button from '../ui/Button.astro';
import type { SupportedLanguage } from '../../i18n/config';
import { t } from '../../i18n/translations';

export interface Props {
  className?: string;
  lang?: SupportedLanguage;
}

const {
  className = '',
  lang = 'en' as SupportedLanguage
} = Astro.props;

const heading = t(lang, 'homepage.quickSelectionHeading');
const intro = t(lang, 'homepage.quickSelectionIntro');
const occasionsTitle = t(lang, 'homepage.bestForOccasions');
const occasionsText = t(lang, 'homepage.bestForOccasionsText');
const occasionsButton = t(lang, 'homepage.viewOccasionGuides');

// Get recommendations from collection filtered by language
const allRecommendations = await getCollection('recommendations');
const recommendations = allRecommendations.filter(r => r.data.lang === lang);
const leftRecommendations = recommendations
  .filter(r => r.data.column === 'left')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
const rightRecommendations = recommendations
  .filter(r => r.data.column === 'right')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
---

<section class={`section-padding ${className}`} aria-labelledby="selection-heading">
  <div class="container">
    <div class="max-w-6xl mx-auto">
      <h2 id="selection-heading" class="text-3xl font-bold text-florize-green mb-6 text-center">
        {heading}
      </h2>
      <p class="text-center text-lg text-gray-700 mb-8 max-w-4xl mx-auto">
        {intro}
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Left Column -->
        <div class="space-y-6">
          {leftRecommendations.map((rec) => (
            <div>
              <h3 class="text-xl font-bold text-florize-green mb-3">{rec.data.title}</h3>
              <p class="text-gray-700 mb-3" set:html={rec.data.description} />
              <Button href={`/${lang}/services/${rec.data.serviceId}`} variant="secondary" size="md" text={rec.data.ctaText} />
            </div>
          ))}
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
          {rightRecommendations.map((rec) => (
            <div>
              <h3 class="text-xl font-bold text-florize-green mb-3">{rec.data.title}</h3>
              <p class="text-gray-700 mb-3" set:html={rec.data.description} />
              <Button href={`/${lang}/services/${rec.data.serviceId}`} variant="secondary" size="md" text={rec.data.ctaText} />
            </div>
          ))}

          <!-- Occasions Link -->
          <div>
            <h3 class="text-xl font-bold text-florize-green mb-3">{occasionsTitle}</h3>
            <p class="text-gray-700 mb-3">
              {occasionsText}
            </p>
            <Button href={`/${lang}/occasions`} variant="secondary" size="md" text={occasionsButton} />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
