---
import { getCollection } from 'astro:content';
import Button from '../ui/Button.astro';
import AffiliateBanner from '../ui/AffiliateBanner.astro';

export interface Props {
  className?: string;
}

const { className = '' } = Astro.props;

// Get recommendations from collection
const allRecommendations = await getCollection('recommendations');
const leftRecommendations = allRecommendations
  .filter(r => r.data.column === 'left')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
const rightRecommendations = allRecommendations
  .filter(r => r.data.column === 'right')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
---

<section class={`section-padding ${className}`} aria-labelledby="selection-heading">
  <div class="container">
    <div class="max-w-6xl mx-auto">
      <h2 id="selection-heading" class="text-3xl font-bold text-florize-green mb-6 text-center">
        Quick Selection Guide - Find Your Perfect Service
      </h2>
      <p class="text-center text-lg text-gray-700 mb-8 max-w-4xl mx-auto">
        Not sure which service is right for you? Use our expert recommendations based on your specific needs and budget.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Left Column -->
        <div class="space-y-6">
          {leftRecommendations.map((rec) => (
            <div>
              <h3 class="text-xl font-bold text-florize-green mb-3">{rec.data.title}</h3>
              <p class="text-gray-700 mb-3" set:html={rec.data.description} />
              <Button href={`/services/${rec.data.serviceId}`} variant="secondary" size="md" text={rec.data.ctaText} />
            </div>
          ))}

          <!-- Affiliate Banners - Left Column -->
          <AffiliateBanner serviceId="myflowers" className="mt-6" />
          <AffiliateBanner serviceId="blossoming-gifts" />
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
          {rightRecommendations.map((rec) => (
            <div>
              <h3 class="text-xl font-bold text-florize-green mb-3">{rec.data.title}</h3>
              <p class="text-gray-700 mb-3" set:html={rec.data.description} />
              <Button href={`/services/${rec.data.serviceId}`} variant="secondary" size="md" text={rec.data.ctaText} />
            </div>
          ))}

          <!-- Affiliate Banner - Right Column -->
          <AffiliateBanner serviceId="appleyard-flowers" className="mt-6" />

          <!-- Occasions Link (hardcoded since it's not a service recommendation) -->
          <div>
            <h3 class="text-xl font-bold text-florize-green mb-3">Best for Specific Occasions</h3>
            <p class="text-gray-700 mb-3">
              Different occasions call for different approaches. Browse our detailed occasion guides for expert recommendations on the best services and flower types for birthdays, anniversaries, sympathy, and more.
            </p>
            <Button href="/occasions" variant="secondary" size="md" text="View Occasion Guides" />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
