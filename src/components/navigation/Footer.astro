---
import { getCollection } from 'astro:content';
import type { SupportedLanguage } from '../../i18n/config';
import { getLanguageFromUrl } from '../../i18n/utils';
import { t } from '../../i18n/translations';
import ImprintModal from '../ui/ImprintModal.astro';

// Get current language
const lang: SupportedLanguage = Astro.currentLocale as SupportedLanguage || getLanguageFromUrl(Astro.url);

// Auto-generate top services for footer (top 3)
const allServices = await getCollection('services');
const services = allServices.filter(service => service.data.lang === lang);
const topServices = services
  .sort((a, b) => (b.data.base.rating || 0) - (a.data.base.rating || 0))
  .slice(0, 3);

// Auto-generate top occasions for footer (top 3)
const allOccasions = await getCollection('occasions');
const occasions = allOccasions.filter(occasion => occasion.data.lang === lang);
const topOccasions = occasions
  .sort((a, b) => a.data.base.name.localeCompare(b.data.base.name))
  .slice(0, 3);

// Get footer content
const allFooterData = await getCollection('homepage-sections');
const footerData = allFooterData.find(section =>
  section.data.sectionType === 'footer' && section.data.lang === lang
);
---

<footer class="bg-charcoal text-white py-12 mt-16">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <h4 class="text-xl font-bold mb-4">{t(lang, 'footer.serviceReviews')}</h4>
        <ul class="space-y-2">
          {topServices.map(service => (
            <li>
              <a href={`/${lang}/services/${service.data.base.id}`} class="hover:text-bloom-pink transition-colors">
                {service.data.base.name} {t(lang, 'nav.review')}
              </a>
            </li>
          ))}
          <li><a href={`/${lang}/services`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.allServices')}</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-xl font-bold mb-4">{t(lang, 'footer.occasionGuides')}</h4>
        <ul class="space-y-2">
          {topOccasions.map(occasion => (
            <li>
              <a href={`/${lang}/occasions/${occasion.data.base.id}`} class="hover:text-bloom-pink transition-colors">
                {occasion.data.base.name} {t(lang, 'nav.flowers')}
              </a>
            </li>
          ))}
          <li><a href={`/${lang}/occasions`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.allOccasions')}</a></li>
        </ul>
      </div>
      <div>
        <h4 class="text-xl font-bold mb-4">{t(lang, 'footer.companyInfo')}</h4>
        <ul class="space-y-2">
          <li><a href={`/${lang}/about`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.aboutFlorize')}</a></li>
          <li><a href={`/${lang}/contact`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.contactUs')}</a></li>
          <li><a href={`/${lang}/privacy-policy`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.privacyPolicy')}</a></li>
          <li><a href={`/${lang}/terms-of-use`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.termsOfUse')}</a></li>
          <li><a href={`/${lang}/affiliate-disclosure`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.affiliateDisclosure')}</a></li>
          <li><a href="#" id="open-imprint-modal" class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.imprint')}</a></li>
          <li><a href={`/${lang}/sitemap-page`} class="hover:text-bloom-pink transition-colors">{t(lang, 'nav.sitemap')}</a></li>
        </ul>
      </div>
    </div>
    <div class="border-t border-gray-700 mt-8 pt-8 text-center">
      <div class="mb-4">
        <img
          src="/images/florizeflowers-logo-white.svg"
          alt="Florize Flowers"
          class="h-8 w-auto mx-auto"
        />
      </div>
      <p>&copy; 2025 Florize Flowers. {t(lang, 'footer.allRightsReserved')}{footerData?.data.description ? ` | ${footerData.data.description}` : ''}</p>
    </div>
  </div>
</footer>

<ImprintModal lang={lang} />
