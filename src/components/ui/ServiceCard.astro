---
import type { CollectionEntry } from 'astro:content';
import Card from './Card.astro';
import RatingStars from './RatingStars.astro';
import Badge from './Badge.astro';
import Button from './Button.astro';
import OptimizedImage from './OptimizedImage.astro';

export interface Props {
  service: CollectionEntry<'services'>;
}

const { service } = Astro.props;
---

<Card className="flex flex-col h-full overflow-hidden p-0">
  {service.data.base.hero_image && (
    <div class="service-card-image">
      <OptimizedImage
        src={service.data.base.hero_image}
        alt={`${service.data.base.name} flowers`}
        width={400}
        height={200}
        loading="lazy"
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
        quality={80}
        class="w-full h-full object-cover"
      />
      {service.data.base.winner_badge && (
        <div class="badge-overlay">
          <Badge text={service.data.base.winner_badge} variant="winner" size="sm" />
        </div>
      )}
    </div>
  )}

  <div class="p-6 flex flex-col flex-grow">
    <div class="flex items-start justify-between mb-4">
      <h2 class="text-2xl font-bold text-florize-green">
        {service.data.base.name}
      </h2>
      {!service.data.base.hero_image && service.data.base.winner_badge && (
        <Badge text={service.data.base.winner_badge} variant="winner" size="sm" />
      )}
    </div>

    <div class="flex items-center gap-2 mb-4">
      <RatingStars rating={service.data.base.rating} size="md" />
      <span class="font-bold text-gray-800">{service.data.base.rating}/5</span>
    </div>

    <p class="text-gray-700 mb-4 flex-grow">
      {service.data.base.description}
    </p>

    <div class="mb-4">
      <div class="text-sm text-gray-600 mb-1">Price Range</div>
      <div class="font-semibold text-florize-green">{service.data.base.price_range}</div>
    </div>

    <div class="flex flex-col gap-2">
      {service.data.affiliate?.url && (
        <Button
          href={service.data.affiliate.url}
          variant="primary"
          size="md"
          text="Visit Service â†’"
          className="w-full text-center"
          target="_blank"
          rel="noopener noreferrer"
        />
      )}
      <Button
        href={`/services/${service.data.base.id}`}
        variant={service.data.affiliate?.url ? "secondary" : "primary"}
        size="md"
        text="Read Full Review"
        className="w-full text-center"
      />
    </div>
  </div>
</Card>

<style>
  .service-card-image {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
  }

  .service-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .service-card-image:hover img {
    transform: scale(1.05);
  }

  .badge-overlay {
    position: absolute;
    top: 12px;
    right: 12px;
  }
</style>
