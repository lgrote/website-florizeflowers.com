---
export interface Props {
  color?: string;
}

const { color = 'var(--florize-green, #4a7c59)' } = Astro.props;
---

<div class="reading-progress-container">
  <div class="reading-progress-bar" id="reading-progress-bar"></div>
</div>

<script>
  function initReadingProgress() {
    const progressBar = document.getElementById('reading-progress-bar');
    if (!progressBar) return;

    function updateProgress() {
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      const scrollTop = window.scrollY;

      // Calculate the scroll percentage
      const scrollableHeight = documentHeight - windowHeight;
      const scrollPercentage = (scrollTop / scrollableHeight) * 100;

      // Update the progress bar width
      progressBar.style.width = `${Math.min(scrollPercentage, 100)}%`;
    }

    // Update on scroll with requestAnimationFrame for smooth performance
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          updateProgress();
          ticking = false;
        });
        ticking = true;
      }
    });

    // Update on resize
    window.addEventListener('resize', updateProgress);

    // Initial update
    updateProgress();
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initReadingProgress);

  // Re-initialize after page transitions
  document.addEventListener('astro:page-load', initReadingProgress);
</script>

<style define:vars={{ color }}>
  .reading-progress-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: 4px;
    background: #e5e7eb;
    z-index: 100;
  }

  .reading-progress-bar {
    height: 100%;
    width: 0%;
    background: var(--color);
    transition: width 0.1s ease-out;
    box-shadow: 0 0 10px rgba(74, 124, 89, 0.3);
  }

  /* Optional: Add a glow effect */
  .reading-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 100%;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3));
    pointer-events: none;
  }
</style>
