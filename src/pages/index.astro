---
// Smart language detection and redirect
import { DEFAULT_LANGUAGE } from '../i18n/config';

// Get browser's preferred language from Accept-Language header
const acceptLanguage = Astro.request.headers.get('accept-language');
let targetLang = DEFAULT_LANGUAGE;

if (acceptLanguage) {
  // Parse the Accept-Language header
  // Format: "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7"
  const languages = acceptLanguage
    .split(',')
    .map(lang => {
      const [code, qValue] = lang.trim().split(';');
      const quality = qValue ? parseFloat(qValue.split('=')[1]) : 1.0;
      return { code: code.toLowerCase().substring(0, 2), quality };
    })
    .sort((a, b) => b.quality - a.quality);

  // Check if German is preferred
  const preferredLang = languages.find(lang => lang.code === 'de');
  if (preferredLang) {
    targetLang = 'de';
  }
}

return Astro.redirect(`/${targetLang}/`);
---
