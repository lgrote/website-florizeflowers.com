---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import BreadcrumbNavigation from '../../components/navigation/BreadcrumbNavigation.astro';
import HeroSection from '../../components/sections/HeroSection.astro';
import Card from '../../components/ui/Card.astro';
import { SUPPORTED_LANGUAGES, type SupportedLanguage } from '../../i18n/config';

export async function getStaticPaths() {
  return SUPPORTED_LANGUAGES.map((lang) => ({
    params: { lang },
  }));
}

const { lang } = Astro.params as { lang: SupportedLanguage };

// Get page content from collection
const allPages = await getCollection('pages');
const pageData = allPages.find(page => page.id === `${lang}/guides-index.md` || page.id === `${lang}/guides-index`);

// Get guides from collection
const allGuides = await getCollection('guides');
const guides = allGuides.filter(guide => guide.data.lang === lang);
const benefitGuides = guides
  .filter(g => g.data.category === 'benefit')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
const essentialGuides = guides
  .filter(g => g.data.category === 'essential')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
const quickTips = guides
  .filter(g => g.data.category === 'quick-tip')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));

// Breadcrumb items
const breadcrumbItems = [
  { label: 'Home', href: `/${lang}` },
  { label: 'Guides' },
];
---

<BaseLayout
  title={pageData.data.title}
  description={pageData.data.description}
  showBreadcrumbs={true}
>
  <BreadcrumbNavigation slot="breadcrumbs" items={breadcrumbItems} />
  <!-- Hero Section -->
  <HeroSection
    title={pageData.data.hero!.title}
    subtitle={pageData.data.hero!.subtitle}
    primaryCta={pageData.data.hero!.primaryCta}
    secondaryCta={pageData.data.hero!.secondaryCta}
    backgroundImage={pageData.data.hero!.backgroundImage}
  />

  <!-- Guides Overview -->
  <section class="section-padding">
    <div class="container">
      <h2 class="text-3xl font-bold text-florize-green mb-6 text-center">{pageData.data.intro!.heading}</h2>
      <p class="text-lg text-gray-700 mb-8 max-w-4xl mx-auto text-center">
        {pageData.data.intro!.paragraph}
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-8">
        {benefitGuides.map((guide) => (
          <Card className="text-center">
            <h3 class="text-xl font-bold text-florize-green mb-3">{guide.data.title}</h3>
            <p class="text-gray-700">
              {guide.data.description}
            </p>
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- Essential Guides -->
  <section id="essential-guides" class="section-padding bg-cream-white">
    <div class="container">
      <h2 class="text-3xl font-bold text-florize-green mb-6 text-center">Essential Buying Guides</h2>
      <p class="text-lg text-gray-700 mb-8 max-w-4xl mx-auto text-center">
        Master these fundamental aspects of flower buying to make confident, informed decisions every time.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {essentialGuides.map((guide) => (
          <Card>
            <h3 class="text-xl font-bold text-florize-green mb-3">{guide.data.title}</h3>
            <p class="text-gray-700 mb-4">
              {guide.data.description}
            </p>
            {guide.data.tips && (
              <ul class="text-sm text-gray-600 space-y-2">
                {guide.data.tips.map((tip) => (
                  <li>â€¢ {tip}</li>
                ))}
              </ul>
            )}
          </Card>
        ))}
      </div>
    </div>
  </section>

  <!-- Quick Tips Section -->
  <section id="quick-tips" class="section-padding">
    <div class="container">
      <h2 class="text-3xl font-bold text-florize-green mb-6 text-center">Quick Tips & Best Practices</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
        {quickTips.map(async (guide) => {
          const { Content } = await guide.render();
          return (
            <Card>
              <h3 class="text-xl font-bold text-florize-green mb-3">{guide.data.title}</h3>
              <div class="text-gray-700 space-y-3">
                <Content />
              </div>
            </Card>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Related Resources -->
  <section class="section-padding bg-cream-white">
    <div class="container">
      <h2 class="text-3xl font-bold text-florize-green mb-6 text-center">Related Resources</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
        <Card className="flex flex-col justify-between">
          <div>
            <h3 class="text-xl font-bold text-florize-green mb-3">Service Reviews</h3>
            <p class="text-gray-700 mb-4">
              Read our expert reviews of the UK's top flower delivery services to find the perfect match for your needs.
            </p>
          </div>
          <a href={`/${lang}/services`} class="btn btn-primary text-center">Browse Service Reviews</a>
        </Card>

        <Card className="flex flex-col justify-between">
          <div>
            <h3 class="text-xl font-bold text-florize-green mb-3">Occasion Guides</h3>
            <p class="text-gray-700 mb-4">
              Find specific recommendations for birthdays, anniversaries, weddings, and other special occasions.
            </p>
          </div>
          <a href={`/${lang}/occasions`} class="btn btn-primary text-center">View Occasion Guides</a>
        </Card>
      </div>
    </div>
  </section>
</BaseLayout>
